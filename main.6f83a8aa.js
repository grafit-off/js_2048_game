parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"KIzB":[function(require,module,exports) {
"use strict";function e(e,s){return r(e)||n(e,s)||i(e,s)||t()}function t(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return s(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function n(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,n=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(l){n=!0,r=l}finally{try{s||null==o.return||o.return()}finally{if(n)throw r}}return i}}function r(e){if(Array.isArray(e))return e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function l(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}var h=function(){function t(e){a(this,t),this.gameEl=e,this.scoreEl=this.gameEl.querySelector(".header__score"),this.scoreInfoEl=this.scoreEl.closest(".header__info"),this.highestScoreEl=this.gameEl.querySelector(".header__highest-score"),this.playBtn=this.gameEl.querySelector(".header__button"),this.messageEl=this.gameEl.querySelector(".message"),this.fieldBody=this.gameEl.querySelector(".field"),this.fieldSize=4,this.fieldState=[],this.score=0,this.gameOver=!1,this.keyUpHandler=this.keyUpHandler.bind(this),this.pressHandler=this.pressHandler.bind(this),this.unpressHandler=this.unpressHandler.bind(this),this.mouseMoves={start:{x:0,y:0},end:{x:0,y:0}},this.tileAppearanceAnimation={keyframes:[{transform:"scale(0.5)"},{transform:"scale(1)"}],options:{duration:400,easing:"cubic-bezier(0.42, 0.97, 0.52, 1.2)"}},this.scoreRefreshAnimation={keyframes:[{transform:"scale(0.8)"},{transform:"scale(1)"}],options:{duration:300,easing:"cubic-bezier(0.42, 0.97, 0.52, 1.1)"}}}return l(t,[{key:"init",value:function(){var e=this,t=this.getRecordFromLocaleStorage()?this.getRecordFromLocaleStorage():0;this.setHighestScoreToMarkup(t),this.playBtn.addEventListener("click",function(){e.startGame(),e.changePlayButtonToRestart(),e.hidePromptMessage()})}},{key:"startGame",value:function(){this.gameOver=!1,this.fieldState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.generateFieldMarkup(),this.generateTileInRandomPlace(),this.generateTileInRandomPlace(),this.setFieldOpacity(),this.setScore(0),this.scoreInfoEl.classList.contains("header__info--active")&&this.scoreInfoEl.classList.remove("header__info--active"),document.addEventListener("keyup",this.keyUpHandler),document.addEventListener("mousedown",this.pressHandler),document.addEventListener("mouseup",this.unpressHandler),document.addEventListener("touchstart",this.pressHandler),document.addEventListener("touchend",this.unpressHandler)}},{key:"finishGame",value:function(){if(this.gameOver=!0,this.removeEventsListeners(),this.isScoreHigherThanRecord()&&(this.setRecordToLocaleStorage(this.score),this.setHighestScoreToMarkup(this.score)),this.isGameWon())return this.showPromptMessage("Winner! Congrats! You did it!","win"),void this.setFieldOpacity("0.8");this.showPromptMessage("You lose! Restart the game?"),this.setFieldOpacity("0.5")}},{key:"slideCurrentLine",value:function(e){var t=this.removeZerosInLine(e);return this.mergeTileInLine(t),t=this.removeZerosInLine(t),this.fillLineByZeros(t),t}},{key:"slideWholeField",value:function(e,t){for(var i=0;i<this.fieldSize;i++){var s=t?this.fieldState[i]:this.getColumnLine(i);s=this.reverseLineBy(e,s),s=this.slideCurrentLine(s),s=this.reverseLineBy(e,s);for(var n=0;n<this.fieldSize;n++){var r=t?i:n,a=t?n:i;this.fieldState[r][a]=s[n],this.updateTileByPosition(r,a)}}}},{key:"slideLeft",value:function(){this.slideWholeField(!1,!0)}},{key:"slideRight",value:function(){this.slideWholeField(!0,!0)}},{key:"slideUp",value:function(){this.slideWholeField(!1,!1)}},{key:"slideDown",value:function(){this.slideWholeField(!0,!1)}},{key:"getPressEventProperties",value:function(e){var t=e;return e.changedTouches&&(t=t.changedTouches[0]),t}},{key:"keyUpHandler",value:function(e){var t=e.code;if(!this.gameOver){switch(t){case"ArrowLeft":this.slideLeft();break;case"ArrowRight":this.slideRight();break;case"ArrowUp":this.slideUp();break;case"ArrowDown":this.slideDown();break;default:return}(this.isGameWon()||this.isGameLosed())&&this.finishGame(),this.addActiveToScoreBy(this.isScoreHigherThanRecord()),this.generateTileInRandomPlace()}}},{key:"pressHandler",value:function(e){var t=this.getPressEventProperties(e);this.mouseMoves.start.x=t.screenX,this.mouseMoves.start.y=t.screenY}},{key:"unpressHandler",value:function(e){if(!this.gameOver){var t=this.getPressEventProperties(e);this.mouseMoves.end.x=t.screenX,this.mouseMoves.end.y=t.screenY;var i=this.mouseMoves.end.x-this.mouseMoves.start.x,s=this.mouseMoves.end.y-this.mouseMoves.start.y,n=Math.abs(i),r=Math.abs(s);if(n<50&&r<50)return;n>r?i>0?this.slideRight():this.slideLeft():s>0?this.slideDown():this.slideUp(),(this.isGameWon()||this.isGameLosed())&&this.finishGame(),this.addActiveToScoreBy(this.isScoreHigherThanRecord()),this.generateTileInRandomPlace()}}},{key:"removeEventsListeners",value:function(){document.removeEventListener("keyup",this.keyupHandler),document.removeEventListener("mousedown",this.pressHandler),document.removeEventListener("mouseup",this.unpressHandler),document.addEventListener("touchstart",this.pressHandler),document.addEventListener("touchend",this.unpressHandler)}},{key:"changePlayButtonToRestart",value:function(){this.playBtn.textContent="Restart",this.playBtn.classList.remove("header__button--start"),this.playBtn.classList.add("header__button--restart")}},{key:"showPromptMessage",value:function(e,t){this.messageEl.textContent=e,this.messageEl.classList.value="message",t&&this.messageEl.classList.add("message--".concat(t))}},{key:"hidePromptMessage",value:function(){this.messageEl.classList.add("message--hidden")}},{key:"addActiveToScoreBy",value:function(e){e&&this.scoreInfoEl.classList.add("header__info--active")}},{key:"setScore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.scoreRefreshAnimation,i=t.keyframes,s=t.options;this.score=e,this.scoreEl.textContent=this.score,this.scoreEl.animate(i,s)}},{key:"setHighestScoreToMarkup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.highestScoreEl.textContent=e}},{key:"setFieldOpacity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.fieldBody.style.opacity=e}},{key:"generateFieldMarkup",value:function(){var e=this;this.fieldBody.innerHTML="";for(var t="",i=function(i){var s="\n        <tr class='field__row'>\n          ".concat(e.fieldState[i].map(function(t,s){return e.generateTile(i,s)}).join(""),"\n        </tr>\n      ");t+=s},s=0;s<this.fieldSize;s++)i(s);this.fieldBody.insertAdjacentHTML("beforeend","<tbody>".concat(t,"</tbody>"))}},{key:"generateTile",value:function(e,t){return'\n      <td class="field__cell" data-position="'.concat(e,"-").concat(t,'">\n        ').concat(this.fieldState[e][t]||"","\n      </td>\n    ")}},{key:"getRecordFromLocaleStorage",value:function(){return localStorage.getItem("best-score")}},{key:"setRecordToLocaleStorage",value:function(e){localStorage.setItem("best-score",e)}},{key:"generateNewTileValue",value:function(){return Math.random()>=.9?4:2}},{key:"generateRandomTileIndex",value:function(){return Math.floor(Math.random()*this.fieldSize)}},{key:"generateRandomTilePosition",value:function(){return[this.generateRandomTileIndex(),this.generateRandomTileIndex()]}},{key:"generateTileInRandomPlace",value:function(){if(this.stateHasEmptyTile())for(var t=!1;!t;){var i=e(this.generateRandomTilePosition(),2),s=i[0],n=i[1];if(0===this.fieldState[s][n]){var r=this.getTileElementByPosition(s,n),a=this.generateNewTileValue(),o=this.tileAppearanceAnimation,l=o.keyframes,h=o.options;this.fieldState[s][n]=a,r.textContent=a,r.classList.add("field__cell--".concat(a)),r.animate(l,h),t=!0}}}},{key:"isGameWon",value:function(){return this.fieldState.flat().includes(2048)}},{key:"isGameLosed",value:function(){if(this.stateHasEmptyTile())return!1;for(var e=0;e<this.fieldSize;e++)for(var t=0;t<this.fieldSize;t++){var i=this.fieldState[e][t],s=this.fieldState[e+1]?this.fieldState[e+1][t]:null,n=this.fieldState[e][t+1]||null;if(0!==i&&(i===s||i===n))return!1}return!0}},{key:"isScoreHigherThanRecord",value:function(){return this.score>+this.getRecordFromLocaleStorage()}},{key:"getTileElementByPosition",value:function(e,t){return document.querySelector("[data-position = '".concat(e+"-"+t,"']"))}},{key:"updateTileByPosition",value:function(e,t){var i=this.getTileElementByPosition(e,t),s=this.fieldState[e][t];i.textContent="",i.classList.value="field__cell",s>0&&(i.textContent=s,i.classList.add("field__cell--"+s))}},{key:"getColumnLine",value:function(e){for(var t=[],i=0;i<this.fieldSize;i++)t.push(this.fieldState[i][e]);return t}},{key:"fillLineByZeros",value:function(e){for(;e.length<this.fieldSize;)e.push(0)}},{key:"removeZerosInLine",value:function(e){return e.filter(function(e){return 0!==e})}},{key:"mergeTileInLine",value:function(e){for(var t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.setScore(this.score+e[t]))}},{key:"reverseLineBy",value:function(e,t){return e?t.reverse():t}},{key:"stateHasEmptyTile",value:function(){for(var e=0;e<this.fieldSize;e++)for(var t=0;t<this.fieldSize;t++)if(0===this.fieldState[e][t])return!0;return!1}}]),t}(),c=document.querySelector(".game"),u=new h(c);u.init();
},{}]},{},["KIzB"], null)
//# sourceMappingURL=main.6f83a8aa.js.map